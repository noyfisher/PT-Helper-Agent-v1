{
  "type": "ios_feature",
  "mode": "pr",
  "title": "Body Map Pain Location Selection",
  "description": "Create an interactive body map view where users can tap on body regions to indicate where they are experiencing pain. The body map should display a front-view human body silhouette built with SwiftUI shapes and overlays (NOT images — use Path/Shape drawing or layered SF Symbols and colored zones). Each tappable zone should highlight when selected and show the region name. Support selecting multiple pain areas. After selecting regions, the user taps 'Continue' to proceed to the analysis flow. This is the entry point of the injury analysis feature, accessible from the home page.",
  "requirements": [
    "Create a BodyRegion model that represents a tappable body zone. Each region has: id (UUID), name (String like 'Left Shoulder', 'Lower Back', 'Right Knee'), zoneKey (String enum-like key for lookup), relativePosition (CGPoint — normalized 0-1 position on the body outline), and isSelected (Bool)",
    "Create a BodyMapViewModel that holds an array of all available BodyRegion objects covering major body areas: Head/Neck, Left Shoulder, Right Shoulder, Upper Back, Lower Back, Chest, Left Elbow, Right Elbow, Left Wrist/Hand, Right Wrist/Hand, Left Hip, Right Hip, Left Knee, Right Knee, Left Ankle/Foot, Right Ankle/Foot, Abdomen. The ViewModel should load the user's existing health profile from Firestore (users/{uid}/profile/health) so it's available for later analysis. Include a toggleSelection(region:) method and a selectedRegions computed property",
    "Create BodyMapView as the main view. It should display a human body silhouette using SwiftUI. Use a ZStack with a body outline shape (drawn with Path or assembled from SF Symbols like 'figure.stand') and overlay tappable circular/oval hotspot buttons at each region's relative position. Selected regions should highlight with the app's accent color (blue) with a pulse animation. Show the region name as a small label near each hotspot",
    "At the top, show a header: 'Where does it hurt?' with subtitle 'Tap all areas where you feel pain or discomfort'. Use the app's standard typography (title2 bold for title, subheadline secondary for subtitle)",
    "At the bottom, show a summary bar: '{N} area(s) selected' and a 'Continue' button (filled blue, rounded corners, disabled if nothing selected). Tapping Continue navigates to the PainDetailView (created in task 2)",
    "Include a 'Clear All' button to deselect everything",
    "The body map must look polished — use Color(.systemGroupedBackground) as the base, a card-style container for the body outline with shadow and rounded corners, and the hotspots should have visible tap targets (at least 44x44pt) with subtle borders when unselected",
    "Use .scrollDismissesKeyboard(.interactively) if there are any text inputs. Add the keyboard dismiss gesture pattern used in the rest of the app",
    "Follow the existing app design patterns: CardSection-style grouping, gradient icon badges, navigation card pattern from ContentView"
  ],
  "deliverables": [
    {
      "path": "ios/PT-Helper/PT-Helper/Models/BodyRegion.swift",
      "type": "new",
      "description": "Model representing a tappable body zone with id, name, zoneKey, relativePosition (CGPoint), and isSelected flag"
    },
    {
      "path": "ios/PT-Helper/PT-Helper/ViewModels/BodyMapViewModel.swift",
      "type": "new",
      "description": "ViewModel holding all BodyRegion instances, managing selection state, loading user profile from Firestore for later analysis use"
    },
    {
      "path": "ios/PT-Helper/PT-Helper/Views/BodyMapView.swift",
      "type": "new",
      "description": "Interactive body map view with tappable regions displayed over a human body silhouette, selection highlighting, summary bar, and Continue button"
    }
  ],
  "context_files": [
    "ios/PT-Helper/PT-Helper/Models/UserProfile.swift",
    "ios/PT-Helper/PT-Helper/ViewModels/OnboardingViewModel.swift",
    "ios/PT-Helper/PT-Helper/ContentView.swift",
    "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/BasicInfoStepView.swift",
    "docs/brief.md"
  ],
  "context": {
    "app_domain": "physical_therapy",
    "target_ios_version": "16.0+",
    "ui_framework": "SwiftUI",
    "architecture_pattern": "MVVM",
    "notes": "The body silhouette must be built with SwiftUI drawing (Path/Shape) or layered SF Symbols — do NOT use image assets. The hotspot positions use normalized coordinates (0-1) relative to the body container bounds. Use GeometryReader to convert normalized positions to actual coordinates. The user's profile (UserProfile) is loaded from Firestore path users/{uid}/profile/health and stored in the ViewModel for use by the analysis engine in task 2."
  }
}
