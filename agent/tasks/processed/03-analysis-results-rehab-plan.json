{
  "type": "ios_feature",
  "mode": "pr",
  "title": "Analysis Results Display and Rehab Plan Builder",
  "description": "Create the analysis results view that displays the injury analysis output (top 3 likely conditions with confidence scores, explanations, red flags, and next steps) and a rehab plan builder that generates a personalized exercise program based on the identified conditions. The results page is the payoff of the entire injury analysis flow — it must be clear, informative, and visually polished. The rehab plan includes exercise cards with descriptions, sets/reps, visual demonstrations using SF Symbols showing body positions, and a weekly schedule. Users can save their analysis and rehab plan to Firestore for future reference.",
  "requirements": [
    "Create AnalysisResultView — the main results screen shown after InjuryAnalyzer completes. Layout: (1) Top disclaimer banner (orange/yellow background, exclamation.triangle.fill icon, text: 'This is not a medical diagnosis. Always consult a healthcare professional.'), (2) Overall summary card with the 2-3 sentence plain-English summary, (3) Condition cards for each of the top 3 conditions, (4) 'Build Rehab Plan' button at the bottom",
    "Each condition card should display: rank number (1, 2, 3) with a colored circle badge, condition name in bold, confidence percentage shown as both text AND a horizontal progress bar (gradient from orange to green based on confidence), the 2-3 sentence explanation text, red flag badge if applicable (red background, 'Seek Immediate Care' message), and an expandable 'Next Steps' section with numbered action items. Use the card styling pattern: white background, cornerRadius(16), shadow, padding",
    "If ANY condition has isRedFlag = true, show a prominent red alert card at the very top (above the disclaimer) with: exclamation.triangle.fill in red, 'Urgent Attention Needed' title, the red flag message, and a 'Call Emergency Services' button (links to tel:911)",
    "Create a RehabPlan model: planName (String), conditions ([String] — the conditions this plan addresses), exercises ([RehabExercise]), weeklySchedule ([[String]] — 7 arrays for each day, containing exercise IDs to do that day), totalWeeks (Int), createdDate (Date), notes (String?)",
    "Create a RehabExercise model: id (UUID), name (String), targetArea (String — body region), description (String — clear instruction for performing the exercise), sets (Int), reps (Int or String like '10-15' or '30 seconds'), restSeconds (Int), difficulty (enum: beginner, intermediate, advanced), demonstrationIcon (String — SF Symbol name showing the movement, e.g. 'figure.flexibility', 'figure.strengthtraining.traditional', 'figure.cooldown', 'figure.yoga'), tips ([String] — 2-3 form tips), contraindications ([String] — when NOT to do this exercise)",
    "Create RehabPlanViewModel that generates a rehab plan from the AnalysisResult. It should have an exercise database organized by condition name — each condition maps to 4-6 recommended exercises. The ViewModel generates a weekly schedule: 3-4 exercise days per week for beginners, 4-5 for intermediate, 5-6 for advanced (based on user's activityLevel from their profile). Rest days are distributed evenly. The plan duration is 4-6 weeks depending on condition severity. Include a method to save the plan to Firestore under users/{uid}/rehabPlans/{planId}",
    "Create RehabPlanView — displays the generated rehab plan. Layout: (1) Plan header card with plan name, conditions addressed, duration, and start date, (2) Weekly calendar strip showing 7 days with dots for exercise days vs rest days, (3) Exercise list for the selected day — each exercise shown as a card with: demonstration icon (large SF Symbol in a colored circle), exercise name, target area tag, sets x reps display, expandable description with form tips. Include 'Start Exercise' button concept (just visual for now)",
    "Create ExerciseDetailView — shown when tapping an exercise card. Full-screen view with: large animated SF Symbol demonstration (use .symbolEffect(.bounce) or .symbolEffect(.pulse) for visual interest), exercise name and target area, full description, sets/reps/rest info in a horizontal stat bar, form tips as numbered list, contraindications as a warning section, and a timer view for timed exercises (simple countdown display using the existing Timer model pattern)",
    "The exercise database should include realistic PT exercises per condition. Examples — Patellofemoral Pain: Quad Sets, Straight Leg Raises, Wall Sits, Clamshells, Step-ups. Rotator Cuff: Pendulum Swings, External Rotation with Band, Scapular Squeezes, Wall Slides, Prone Y Raises. Lower Back: Cat-Cow Stretch, Bird Dog, Dead Bug, Pelvic Tilts, Glute Bridges, Child's Pose. Include at least 4-5 exercises per condition",
    "Include a 'Save Plan' button that writes the plan to Firestore. Show a success confirmation with checkmark animation after saving. Include a 'Share Results' button placeholder (just shows an alert saying 'Coming soon — share with your trainer')",
    "All views must follow the app's design system: Color(.systemGroupedBackground) base, card sections with .shadow(color: .black.opacity(0.04), radius: 8, y: 2) and cornerRadius(14-16), SF Symbols for all icons, gradient icon badges for section headers, filled blue primary buttons with white text, proper typography hierarchy (title2 bold for titles, body semibold for card headers, caption for metadata), empty states with icon + title + subtitle if no plan exists yet"
  ],
  "deliverables": [
    {
      "path": "ios/PT-Helper/PT-Helper/Models/RehabPlan.swift",
      "type": "new",
      "description": "Data models for RehabPlan (plan metadata + exercises + schedule) and RehabExercise (exercise details with demonstration info, sets/reps, tips, contraindications)"
    },
    {
      "path": "ios/PT-Helper/PT-Helper/ViewModels/RehabPlanViewModel.swift",
      "type": "new",
      "description": "ViewModel that generates a personalized rehab plan from AnalysisResult, manages exercise database per condition, creates weekly schedules, handles Firestore save"
    },
    {
      "path": "ios/PT-Helper/PT-Helper/Views/AnalysisResultView.swift",
      "type": "new",
      "description": "Results display showing top 3 conditions with confidence bars, explanations, red flag alerts, next steps, disclaimer banner, and Build Rehab Plan button"
    },
    {
      "path": "ios/PT-Helper/PT-Helper/Views/RehabPlanView.swift",
      "type": "new",
      "description": "Rehab plan display with weekly calendar, daily exercise list as cards with SF Symbol demonstrations, save/share functionality"
    },
    {
      "path": "ios/PT-Helper/PT-Helper/Views/ExerciseDetailView.swift",
      "type": "new",
      "description": "Full exercise detail screen with animated SF Symbol demonstration, description, sets/reps stats, form tips, contraindications, and timer for timed exercises"
    }
  ],
  "context_files": [
    "ios/PT-Helper/PT-Helper/Models/PainAssessment.swift",
    "ios/PT-Helper/PT-Helper/Models/InjuryAnalyzer.swift",
    "ios/PT-Helper/PT-Helper/Models/BodyRegion.swift",
    "ios/PT-Helper/PT-Helper/Models/UserProfile.swift",
    "ios/PT-Helper/PT-Helper/ViewModels/InjuryAnalysisViewModel.swift",
    "ios/PT-Helper/PT-Helper/ViewModels/OnboardingViewModel.swift",
    "ios/PT-Helper/PT-Helper/Views/PainDetailView.swift",
    "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/MedicalHistoryStepView.swift",
    "ios/PT-Helper/PT-Helper/ContentView.swift",
    "ios/PT-Helper/PT-Helper/Models/Timer.swift",
    "docs/brief.md"
  ],
  "context": {
    "app_domain": "physical_therapy",
    "target_ios_version": "16.0+",
    "ui_framework": "SwiftUI",
    "architecture_pattern": "MVVM",
    "notes": "This task builds on tasks 1 and 2. The PainDetailView (task 2) navigates to AnalysisResultView after analysis completes, passing the AnalysisResult. The AnalysisResultView navigates to RehabPlanView when 'Build Rehab Plan' is tapped. All exercise demonstrations use SF Symbols (figure.* family) — do NOT use images or assets. The Firestore path for rehab plans is users/{uid}/rehabPlans/{planId}. The exercise database is a static dictionary in the ViewModel — it does NOT call any external API. The Optional<String>.bound extension already exists in MedicalHistoryStepView.swift — do NOT redefine it. Use the existing Array safe subscript extension if available, or define it in a shared file. For the timer functionality, reference the existing Timer model at ios/PT-Helper/PT-Helper/Models/Timer.swift for patterns."
  }
}
