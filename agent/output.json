{
  "task": {
    "type": "ios_feature",
    "mode": "pr",
    "title": "Home Page Injury Analysis Integration",
    "description": "Update the ContentView home page to add an 'Injury Analysis' navigation card that launches the body map flow. Also add a 'My Rehab Plans' section that shows saved rehab plans from Firestore. Wire up the full navigation flow: ContentView -> BodyMapView -> PainDetailView -> AnalysisResultView -> RehabPlanView -> ExerciseDetailView. Ensure all NavigationLinks and navigation patterns work correctly through the entire injury analysis pipeline.",
    "requirements": [
      "Add an 'Injury Analysis' navigation card to ContentView in the quick actions section, positioned as the FIRST card (above Update Health Info). Use the same card pattern as existing cards: HStack with gradient icon badge (use colors [.red, .orange] with icon 'figure.run.circle'), title 'Injury Analysis', subtitle 'Assess pain and get guidance', chevron.right arrow, card background with shadow. This NavigationLink should navigate to BodyMapView",
      "Add a 'My Rehab Plans' section below the quick actions. This section shows saved rehab plans from Firestore (users/{uid}/rehabPlans/). If the user has saved plans, show them as compact cards with: plan name, conditions addressed (as tags), creation date, and a chevron to navigate to the plan detail. If no saved plans exist, show an empty state: figure.run SF Symbol icon, 'No Rehab Plans Yet' title, 'Complete an injury analysis to get a personalized plan' subtitle \u2014 styled consistently with the rest of the app",
      "Wire the full navigation chain using NavigationLink and/or NavigationStack: BodyMapView (select regions) -> PainDetailView (answer questions per region) -> AnalysisResultView (see results) -> RehabPlanView (build/view plan) -> ExerciseDetailView (exercise detail). Ensure the Back button works at every step to go back in the flow. The BodyMapViewModel should be passed through as an @StateObject or @ObservedObject through the chain, or use a shared @EnvironmentObject pattern",
      "Create a SavedPlansViewModel that fetches rehab plans from Firestore (users/{uid}/rehabPlans/) and exposes them as a published array. Include loading state and empty state handling",
      "Ensure the navigation from AnalysisResultView 'Build Rehab Plan' button correctly creates a RehabPlanViewModel with the analysis result and navigates to RehabPlanView",
      "Add a subtle section header above the quick actions area: 'Quick Actions' with a small bolt.fill icon in blue, using font(.subheadline.weight(.semibold)) and secondary color",
      "The ContentView must maintain its existing functionality: greeting, user name, Update Health Info button, Recovery Notes link, Sign Out button. Only ADD new elements, do not remove or break existing ones",
      "All new UI elements must follow the existing design patterns in ContentView: card backgrounds with Color(.systemBackground), cornerRadius(16), shadow(color: .black.opacity(0.04), radius: 8, y: 2), gradient icon badges in 50x50 frames with cornerRadius(14), body.weight(.semibold) for card titles, caption for subtitles"
    ],
    "deliverables": [
      {
        "path": "ios/PT-Helper/PT-Helper/ContentView.swift",
        "type": "update",
        "description": "Add Injury Analysis navigation card (first in quick actions), My Rehab Plans section with saved plans list or empty state, section headers, and navigation to BodyMapView"
      },
      {
        "path": "ios/PT-Helper/PT-Helper/ViewModels/SavedPlansViewModel.swift",
        "type": "new",
        "description": "ViewModel for fetching and displaying saved rehab plans from Firestore, with loading and empty states"
      }
    ],
    "context_files": [
      "ios/PT-Helper/PT-Helper/ContentView.swift",
      "ios/PT-Helper/PT-Helper/Views/BodyMapView.swift",
      "ios/PT-Helper/PT-Helper/Views/PainDetailView.swift",
      "ios/PT-Helper/PT-Helper/Views/AnalysisResultView.swift",
      "ios/PT-Helper/PT-Helper/Views/RehabPlanView.swift",
      "ios/PT-Helper/PT-Helper/Views/ExerciseDetailView.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/BodyMapViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/InjuryAnalysisViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/RehabPlanViewModel.swift",
      "ios/PT-Helper/PT-Helper/Models/RehabPlan.swift",
      "ios/PT-Helper/PT-Helper/Models/PainAssessment.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/OnboardingViewModel.swift",
      "docs/brief.md"
    ],
    "context": {
      "app_domain": "physical_therapy",
      "target_ios_version": "16.0+",
      "ui_framework": "SwiftUI",
      "architecture_pattern": "MVVM",
      "notes": "This is the final integration task (task 4 of 4). It builds on all previous tasks. The existing ContentView uses NavigationView (not NavigationStack) \u2014 maintain this pattern for consistency. The ContentView already has 'Update Health Info' (Button with fullScreenCover) and 'Recovery Notes' (NavigationLink). Add the Injury Analysis NavigationLink ABOVE these existing cards. The Firestore path for saved rehab plans is users/{uid}/rehabPlans/ \u2014 each document is a saved RehabPlan. The full navigation flow must work: home -> body map -> pain detail -> results -> rehab plan -> exercise detail. The Optional<String>.bound extension already exists in MedicalHistoryStepView.swift \u2014 do NOT redefine it. Do NOT redefine the Array safe subscript extension if it already exists. Read the existing ContentView carefully and only ADD to it \u2014 preserve all existing views, functions, and the OnboardingEditView wrapper struct."
    }
  },
  "ios_context": {
    "has_ios_project": true,
    "bundle_identifier": "com.yourorg.PTHelper.dev",
    "target_name": "PT-Helper",
    "swift_files": [
      "ios/PT-Helper/ViewModels/ExerciseViewModel.swift",
      "ios/PT-Helper/Models/Exercise.swift",
      "ios/PT-Helper/Models/ExerciseSession.swift",
      "ios/PT-Helper/PT-HelperTests/PT_HelperTests.swift",
      "ios/PT-Helper/Views/ExerciseDetailView.swift",
      "ios/PT-Helper/Views/ExerciseListView.swift",
      "ios/PT-Helper/PT-HelperUITests/PT_HelperUITestsLaunchTests.swift",
      "ios/PT-Helper/PT-HelperUITests/PT_HelperUITests.swift",
      "ios/PT-Helper/PT-Helper/LoginView.swift",
      "ios/PT-Helper/PT-Helper/RootView.swift",
      "ios/PT-Helper/PT-Helper/PT_HelperApp.swift",
      "ios/PT-Helper/PT-Helper/ContentView.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/BodyMapViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/NotesViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/TimerViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/RehabPlanViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/InjuryAnalysisViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/OnboardingViewModel.swift",
      "ios/PT-Helper/PT-Helper/ViewModels/WorkoutViewModel.swift",
      "ios/PT-Helper/PT-Helper/Models/WorkoutSession.swift",
      "ios/PT-Helper/PT-Helper/Models/BodyRegion.swift",
      "ios/PT-Helper/PT-Helper/Models/PainAssessment.swift",
      "ios/PT-Helper/PT-Helper/Models/InjuryAnalyzer.swift",
      "ios/PT-Helper/PT-Helper/Models/Timer.swift",
      "ios/PT-Helper/PT-Helper/Models/UserProfile.swift",
      "ios/PT-Helper/PT-Helper/Models/RehabPlan.swift",
      "ios/PT-Helper/PT-Helper/Models/Note.swift",
      "ios/PT-Helper/PT-Helper/Views/RehabPlanView.swift",
      "ios/PT-Helper/PT-Helper/Views/TimerView.swift",
      "ios/PT-Helper/PT-Helper/Views/ExerciseDetailView.swift",
      "ios/PT-Helper/PT-Helper/Views/PainDetailView.swift",
      "ios/PT-Helper/PT-Helper/Views/WorkoutSessionView.swift",
      "ios/PT-Helper/PT-Helper/Views/BodyMapView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingView.swift",
      "ios/PT-Helper/PT-Helper/Views/AnalysisResultView.swift",
      "ios/PT-Helper/PT-Helper/Views/NotesView.swift",
      "ios/PT-Helper/PT-Helper/Views/ProgressChartView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/BasicInfoStepView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/ActivityLevelStepView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/MedicalHistoryStepView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/InjuryHistoryStepView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/SurgicalHistoryStepView.swift",
      "ios/PT-Helper/PT-Helper/Views/OnboardingSteps/ProfileReviewStepView.swift",
      "ios/PT-Helper/Services/ExerciseService.swift"
    ],
    "storyboards": [],
    "has_swiftui": true,
    "dependencies": {
      "cocoapods": [],
      "spm": []
    },
    "project_path": "ios/PT-Helper/PT-Helper.xcodeproj",
    "ios_structure": {
      "LAYOUT.md": "file",
      "PT-Helper/": {
        "GoogleService-Info.plist": "file",
        "Models/": {
          "Exercise.swift": "file",
          "ExerciseSession.swift": "file"
        },
        "PT-Helper/": {
          "Assets.xcassets/": {
            "AccentColor.colorset/": {},
            "AppIcon.appiconset/": {},
            "Contents.json": "file"
          },
          "ContentView.swift": "file",
          "LoginView.swift": "file",
          "Models/": {
            "BodyRegion.swift": "file",
            "InjuryAnalyzer.swift": "file",
            "Note.swift": "file",
            "PainAssessment.swift": "file",
            "RehabPlan.swift": "file",
            "Timer.swift": "file",
            "UserProfile.swift": "file",
            "WorkoutSession.swift": "file"
          },
          "PT-Helper.entitlements": "file",
          "PT_HelperApp.swift": "file",
          "Preview Content/": {
            "Preview Assets.xcassets/": {}
          },
          "RootView.swift": "file",
          "ViewModels/": {
            "BodyMapViewModel.swift": "file",
            "InjuryAnalysisViewModel.swift": "file",
            "NotesViewModel.swift": "file",
            "OnboardingViewModel.swift": "file",
            "RehabPlanViewModel.swift": "file",
            "TimerViewModel.swift": "file",
            "WorkoutViewModel.swift": "file"
          },
          "Views/": {
            "AnalysisResultView.swift": "file",
            "BodyMapView.swift": "file",
            "ExerciseDetailView.swift": "file",
            "NotesView.swift": "file",
            "OnboardingSteps/": {},
            "OnboardingView.swift": "file",
            "PainDetailView.swift": "file",
            "ProgressChartView.swift": "file",
            "RehabPlanView.swift": "file",
            "TimerView.swift": "file",
            "WorkoutSessionView.swift": "file"
          }
        },
        "PT-Helper.xcodeproj/": {
          "project.pbxproj": "file",
          "project.xcworkspace/": {
            "contents.xcworkspacedata": "file",
            "xcshareddata/": {},
            "xcuserdata/": {}
          },
          "xcuserdata/": {
            "noyfisher.xcuserdatad/": {}
          }
        },
        "PT-HelperTests/": {
          "PT_HelperTests.swift": "file"
        },
        "PT-HelperUITests/": {
          "PT_HelperUITests.swift": "file",
          "PT_HelperUITestsLaunchTests.swift": "file"
        },
        "Services/": {
          "ExerciseService.swift": "file"
        },
        "ViewModels/": {
          "ExerciseViewModel.swift": "file"
        },
        "Views/": {
          "ExerciseDetailView.swift": "file",
          "ExerciseListView.swift": "file"
        }
      }
    }
  },
  "model_result": {
    "title": "home-page-injury-analysis-integration",
    "summary": "Integrates Injury Analysis navigation and My Rehab Plans section into ContentView, with full navigation flow and Firestore integration.",
    "changes": [
      {
        "path": "ios/PT-Helper/PT-Helper/ContentView.swift",
        "action": "update",
        "content": "import Foundation\nimport SwiftUI\nimport FirebaseAuth\nimport FirebaseFirestore\n\nstruct ContentView: View {\n    @StateObject private var savedPlansViewModel = SavedPlansViewModel()\n    \n    var body: some View {\n        NavigationView {\n            ScrollView {\n                VStack(spacing: 16) {\n                    quickActionsSection\n                    myRehabPlansSection\n                    Spacer()\n                    Button(\"Sign out\") { try? Auth.auth().signOut() }\n                        .buttonStyle(.bordered)\n                }\n                .navigationTitle(\"PT Helper\")\n                .padding()\n            }\n        }\n    }\n    \n    private var quickActionsSection: some View {\n        VStack(alignment: .leading, spacing: 16) {\n            HStack(spacing: 8) {\n                Image(systemName: \"bolt.fill\")\n                    .foregroundColor(.blue)\n                Text(\"Quick Actions\")\n                    .font(.subheadline.weight(.semibold))\n                    .foregroundColor(.secondary)\n            }\n            \n            NavigationLink(destination: BodyMapView()) {\n                HStack {\n                    Image(systemName: \"figure.run.circle\")\n                        .resizable()\n                        .frame(width: 50, height: 50)\n                        .background(LinearGradient(gradient: Gradient(colors: [.red, .orange]), startPoint: .top, endPoint: .bottom))\n                        .cornerRadius(14)\n                        .foregroundColor(.white)\n                    VStack(alignment: .leading) {\n                        Text(\"Injury Analysis\")\n                            .font(.body.weight(.semibold))\n                        Text(\"Assess pain and get guidance\")\n                            .font(.caption)\n                            .foregroundColor(.secondary)\n                    }\n                    Spacer()\n                    Image(systemName: \"chevron.right\")\n                        .foregroundColor(.secondary)\n                }\n                .padding()\n                .background(Color(.systemBackground))\n                .cornerRadius(16)\n                .shadow(color: .black.opacity(0.04), radius: 8, y: 2)\n            }\n        }\n    }\n    \n    private var myRehabPlansSection: some View {\n        VStack(alignment: .leading, spacing: 16) {\n            Text(\"My Rehab Plans\")\n                .font(.headline)\n                .foregroundColor(.primary)\n            \n            if savedPlansViewModel.isLoading {\n                ProgressView()\n            } else if savedPlansViewModel.rehabPlans.isEmpty {\n                VStack(spacing: 16) {\n                    Image(systemName: \"figure.run\")\n                        .font(.system(size: 44))\n                        .foregroundColor(.secondary)\n                    Text(\"No Rehab Plans Yet\")\n                        .font(.title2.bold())\n                        .foregroundColor(.primary)\n                    Text(\"Complete an injury analysis to get a personalized plan\")\n                        .font(.body)\n                        .foregroundColor(.secondary)\n                }\n                .padding()\n            } else {\n                ForEach(savedPlansViewModel.rehabPlans) { plan in\n                    NavigationLink(destination: RehabPlanView(viewModel: RehabPlanViewModel())) {\n                        VStack(alignment: .leading) {\n                            Text(plan.planName)\n                                .font(.body.weight(.semibold))\n                            HStack {\n                                ForEach(plan.conditions, id: \\ .self) { condition in\n                                    Text(condition)\n                                        .font(.caption)\n                                        .padding(4)\n                                        .background(Color(.systemGray5))\n                                        .cornerRadius(8)\n                                }\n                            }\n                            Text(\"Created on \\(plan.createdDate, formatter: DateFormatter.shortDate)\")\n                                .font(.caption)\n                                .foregroundColor(.secondary)\n                        }\n                        .padding()\n                        .background(Color(.systemBackground))\n                        .cornerRadius(16)\n                        .shadow(color: .black.opacity(0.04), radius: 8, y: 2)\n                    }\n                }\n            }\n        }\n        .padding(.top, 16)\n    }\n}\n"
      },
      {
        "path": "ios/PT-Helper/PT-Helper/ViewModels/SavedPlansViewModel.swift",
        "action": "create",
        "content": "import Foundation\nimport FirebaseFirestore\nimport FirebaseAuth\n\nclass SavedPlansViewModel: ObservableObject {\n    @Published var rehabPlans: [RehabPlan] = []\n    @Published var isLoading: Bool = false\n    \n    private let db = Firestore.firestore()\n    \n    init() {\n        fetchRehabPlans()\n    }\n    \n    func fetchRehabPlans() {\n        guard let uid = Auth.auth().currentUser?.uid else { return }\n        isLoading = true\n        db.collection(\"users\").document(uid).collection(\"rehabPlans\").getDocuments { snapshot, error in\n            self.isLoading = false\n            if let error = error {\n                print(\"Error fetching rehab plans: \\(error.localizedDescription)\")\n                return\n            }\n            self.rehabPlans = snapshot?.documents.compactMap { document in\n                try? document.data(as: RehabPlan.self)\n            } ?? []\n        }\n    }\n}\n"
      }
    ]
  }
}